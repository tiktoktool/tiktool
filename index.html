<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Seller Tiktok Chat Pro Custom</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <style>
        /* --- 1. SETTING TEMA & VARIABEL --- */
        :root {
            --primary: #FE2C55;
            --primary-hover: #e0244a;
            --bg-body: #f0f2f5;
            --bg-card: #ffffff;
            --bg-panel: #fafafa;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 2px 10px rgba(0,0,0,0.06);
            --shadow-lg: 0 4px 20px rgba(0,0,0,0.08);
            --danger: #ef4444;
            --success: #10b981;
            --warning-bg: #fff1f2;
            --header-bg: #ffffff;
            --color-cat-default: #3b82f6;
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --bg-panel: #1e293b;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
            --shadow: 0 2px 10px rgba(0,0,0,0.15);
            --shadow-lg: 0 4px 20px rgba(0,0,0,0.25);
            --warning-bg: #450a0a;
            --header-bg: #1e293b;
        }

        /* Reset dan base styles */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            transition: var(--transition);
            padding-bottom: 120px;
            font-size: 14px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- 2. HEADER & TOP BAR --- */
        .sticky-header {
            background-color: var(--header-bg);
            padding: 12px 15px;
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: var(--shadow-lg);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            backdrop-filter: blur(8px);
        }
        
        .header-left { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
        }
        
        h2 { 
            margin: 0; 
            color: var(--primary); 
            font-size: 18px; 
            font-weight: 800; 
            letter-spacing: -0.5px; 
            background: linear-gradient(135deg, var(--primary), #ff6b9c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header-actions { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        .btn-top { 
            padding: 8px 12px; 
            font-size: 12px; 
            border-radius: 8px; 
            border: 1px solid var(--border); 
            background: var(--bg-card); 
            color: var(--text-main); 
            cursor: pointer; 
            font-weight: 600; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            transition: var(--transition);
            box-shadow: var(--shadow);
            touch-action: manipulation;
        }
        
        .btn-top:hover, .btn-top:active {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Language Selector */
        .language-selector {
            position: relative;
            display: inline-block;
        }
        
        .lang-btn {
            padding: 6px 10px;
            font-size: 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-main);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }
        
        .lang-btn:hover {
            background: var(--bg-panel);
        }
        
        .lang-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            min-width: 100px;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            margin-top: 5px;
        }
        
        .lang-dropdown.show {
            display: block;
        }
        
        .lang-option {
            padding: 8px 12px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .lang-option:hover {
            background: var(--bg-panel);
        }
        
        .lang-option.active {
            background: var(--primary);
            color: white;
        }

        /* Theme Switch */
        .theme-switch { 
            position: relative; 
            display: inline-block; 
            width: 40px; 
            height: 22px; 
        } 
        
        .theme-switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }
        
        .slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: #ccc; 
            transition: var(--transition); 
            border-radius: 34px; 
        }
        
        .slider:before { 
            position: absolute; 
            content: ""; 
            height: 18px; 
            width: 18px; 
            left: 2px; 
            bottom: 2px; 
            background-color: white; 
            transition: var(--transition); 
            border-radius: 50%; 
        }
        
        input:checked + .slider { 
            background-color: var(--primary); 
        }
        
        input:checked + .slider:before { 
            transform: translateX(18px); 
        }

        /* Info Bar */
        .info-bar {
            background: linear-gradient(135deg, var(--primary), #ff6b9c);
            color: white;
            padding: 10px 15px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            box-shadow: var(--shadow);
        }

        /* --- 4. LAYOUT UTAMA (Responsive Grid) --- */
        #app-container {
            max-width: 1200px;
            margin: 15px auto;
            padding: 0 10px;
            display: flex; 
            flex-direction: column;
            gap: 15px;
        }
        
        /* Tablet dan Desktop */
        @media (min-width: 768px) {
            #app-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
                padding: 0 15px;
            }
            
            /* Style untuk kolom kiri dan kanan */
            .left-column, .right-column {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }
        }

        /* Desktop besar */
        @media (min-width: 1024px) {
            #app-container {
                gap: 25px;
            }
        }

        /* --- 5. MENU & CARD STYLES --- */
        .category-item {
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            overflow: hidden;
            margin-bottom: 0; 
            transition: var(--transition);
            min-height: 60px;
            display: flex;
            flex-direction: column;
        }
        
        .category-item:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .category-header {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            background: var(--bg-card);
            transition: var(--transition);
            flex-shrink: 0;
            -webkit-user-select: none;
            user-select: none;
        }

        .category-header:active {
            background: var(--bg-panel);
        }

        @media (min-width: 768px) {
            .category-header:hover {
                background: var(--bg-panel);
            }
        }

        .header-content { 
            flex-grow: 1; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            font-weight: 600; 
            font-size: 15px; 
            color: var(--text-main); 
            padding: 5px 0; 
        }

        /* Styling for the dynamically added input */
        .header-content input {
            padding: 6px 10px;
            font-size: 15px;
            font-weight: 600;
            border: 1px solid var(--primary);
            border-radius: 6px;
            background-color: var(--bg-body);
            color: var(--text-main);
            flex-grow: 1;
            margin-left: 10px;
            box-sizing: border-box;
            outline: none;
            transition: var(--transition);
            -webkit-appearance: none;
        }

        .header-content input:focus {
            box-shadow: 0 0 0 2px rgba(254, 44, 85, 0.2);
        }

        /* Panel Isi: Area Submenu */
        .panel { 
            max-height: 0;
            overflow: hidden;
            padding: 0 15px;
            background-color: var(--bg-panel); 
            border-top: 1px solid transparent; 
            transition: max-height 0.3s ease, padding 0.3s ease;
            flex-grow: 1;
        }
        
        .panel.open { 
            max-height: 1000px;
            padding: 12px 15px;
            border-top: 1px solid var(--border);
        }

        @media (min-width: 768px) {
            .panel {
                padding: 0 20px;
            }
            
            .panel.open {
                padding: 15px 20px;
            }
        }

        /* Script Card (Compact) */
        .script-card {
            background: var(--bg-card);
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: relative;
            border-left: 4px solid var(--color-cat);
            transition: var(--transition);
            box-shadow: var(--shadow);
        }
        
        .script-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 8px; 
        }
        
        .card-title { 
            font-size: 12px; 
            font-weight: 700; 
            color: var(--primary); 
            letter-spacing: -0.2px;
        }

        .card-body {
            font-size: 14px;
            line-height: 1.6;
            padding: 10px;
            background: var(--bg-body);
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        
        .card-body:active {
            background: var(--bg-panel);
            border-color: var(--border);
        }

        @media (min-width: 768px) {
            .card-body:hover {
                background: var(--bg-panel);
                border-color: var(--border);
            }
        }

        .tap-hint {
            font-size: 11px;
            color: var(--text-muted);
            text-align: center;
            margin-top: 5px;
            font-style: italic;
        }

        .form-input { 
            width: 100%; 
            padding: 10px; 
            font-size: 14px; 
            margin-bottom: 10px;
            border: 1px solid var(--border); 
            background: var(--bg-body); 
            color: var(--text-main); 
            border-radius: 8px; 
            box-sizing: border-box;
            transition: var(--transition);
            -webkit-appearance: none;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(254, 44, 85, 0.2);
        }
        
        .btn { 
            padding: 8px 12px; 
            font-size: 12px; 
            border-radius: 8px; 
            gap: 5px; 
            border: none;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            touch-action: manipulation;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover, .btn-primary:active {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover, .btn-danger:active {
            background: #dc2626;
            transform: translateY(-1px);
        }
        
        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .btn-icon {
            padding: 6px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* FAB Button */
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: var(--transition);
            z-index: 100;
            touch-action: manipulation;
        }
        
        .fab:hover, .fab:active {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(254, 44, 85, 0.4);
        }

        /* Toast Notification */
        #toast {
            visibility: hidden;
            min-width: 300px;
            background-color: var(--success);
            color: white;
            text-align: center;
            border-radius: 8px;
            padding: 16px 20px;
            position: fixed;
            z-index: 1000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-weight: 500;
            box-shadow: var(--shadow-lg);
            transition: visibility 0s, opacity 0.3s ease;
            opacity: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        #toast.show {
            visibility: visible;
            opacity: 1;
        }

        /* Flag Counter Styles */
        .flag-counter-container {
            text-align: center;
            margin: 25px auto 15px;
            padding: 15px;
            max-width: 600px;
            border-radius: var(--radius);
            background: var(--bg-card);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        
        .flag-counter-img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            transition: var(--transition);
        }
        
        .flag-counter-img:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        @media (max-width: 768px) {
            .flag-counter-container {
                margin: 20px 10px 10px;
                padding: 12px;
            }
        }

        /* Storage Info Panel */
        .storage-info-panel {
            max-width: 600px;
            margin: 20px auto 10px;
            padding: 12px 15px;
            background: var(--bg-card);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .storage-info-content {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-grow: 1;
        }
        
        .storage-info-text {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        .storage-info-text strong {
            color: var(--primary);
        }
        
        .storage-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-clear-storage {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
            background: var(--danger);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }
        
        .btn-clear-storage:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }
        
        .btn-check-storage {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
            background: var(--bg-panel);
            color: var(--text-main);
            border: 1px solid var(--border);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }
        
        .btn-check-storage:hover {
            background: var(--bg-body);
        }
        
        @media (max-width: 768px) {
            .storage-info-panel {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
            }
            
            .storage-info-content {
                justify-content: center;
                margin-bottom: 10px;
            }
            
            .storage-actions {
                justify-content: center;
            }
        }

        /* Copy Success Animation */
        @keyframes copySuccess {
            0% { transform: translateX(-50%) scale(0.9); opacity: 0; }
            70% { transform: translateX(-50%) scale(1.05); opacity: 1; }
            100% { transform: translateX(-50%) scale(1); opacity: 1; }
        }
        
        .copy-success {
            animation: copySuccess 0.4s ease-out;
        }

        /* Multi-language Support Badge */
        .lang-badge {
            position: fixed;
            top: 80px;
            right: 15px;
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            z-index: 40;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 5px;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @media (max-width: 768px) {
            .lang-badge {
                top: 70px;
                right: 10px;
                font-size: 10px;
                padding: 5px 10px;
            }
        }

        /* Modal untuk Create New Folder */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            backdrop-filter: blur(4px);
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-main);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 20px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            background: var(--bg-panel);
            color: var(--danger);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-main);
            font-size: 14px;
        }
        
        .form-hint {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 5px;
            line-height: 1.4;
        }
        
        /* Example Item */
        .example-item {
            background: var(--bg-panel);
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
            border: 1px dashed var(--border);
        }
        
        .example-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .example-text {
            font-size: 13px;
            line-height: 1.5;
            color: var(--text-muted);
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        
        .risk-alert {
            background: var(--warning-bg);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 13px;
        }
        
        .drag-handle {
            cursor: move;
            color: var(--text-muted);
            transition: var(--transition);
            touch-action: none;
        }
        
        .drag-handle:hover {
            color: var(--primary);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
            font-size: 16px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .category-item, .script-card {
            animation: fadeIn 0.3s ease;
        }

        /* Responsive adjustments for mobile landscape */
        @media (max-width: 767px) and (orientation: landscape) {
            body {
                padding-bottom: 80px;
            }
            
            .sticky-header {
                padding: 8px 10px;
            }
            
            h2 {
                font-size: 16px;
            }
            
            #app-container {
                margin: 10px auto;
                gap: 10px;
            }
            
            .category-item {
                min-height: 50px;
            }
            
            .category-header {
                padding: 10px 12px;
            }
            
            .fab {
                bottom: 15px;
                right: 15px;
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
        }

        /* Perbaikan untuk iOS */
        @supports (-webkit-touch-callout: none) {
            .category-header, .card-body, .btn, .fab {
                cursor: pointer;
            }
        }
    </style>
</head>
<body>

    <div class="sticky-header">
        <div class="header-left">
            <h2 id="app-title">Seller Tiktok Chat Pro Custom</h2>
            <div class="theme-switch-wrapper">
                <label class="theme-switch" for="checkbox">
                    <input type="checkbox" id="checkbox" onchange="toggleTheme(this)">
                    <div class="slider round"></div>
                </label>
            </div>
        </div>

        <div class="header-actions">
            <div class="language-selector">
                <button class="lang-btn" onclick="toggleLanguageDropdown()">
                    <i class="fas fa-globe"></i>
                    <span id="current-lang">ID</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="lang-dropdown" id="lang-dropdown">
                    <div class="lang-option active" data-lang="id" onclick="changeLanguage('id')">
                        <span>üáÆüá© Indonesia</span>
                    </div>
                    <div class="lang-option" data-lang="en" onclick="changeLanguage('en')">
                        <span>üá∫üá∏ English</span>
                    </div>
                </div>
            </div>
            
            <button class="btn-top btn-reset" onclick="resetToDefault()">
                <i class="fas fa-rotate-left"></i> <span id="reset-btn">Reset</span>
            </button>
            <button class="btn-top btn-clear" onclick="deleteAll()">
                <i class="fas fa-trash-alt"></i> <span id="delete-btn">Hapus Semua</span>
            </button>
        </div>
    </div>

    <div class="lang-badge">
        <i class="fas fa-language"></i> Multi-language
    </div>

    <div class="info-bar">
        <i class="fas fa-shield-alt"></i> <b id="info-title">INFO PENTING:</b> <span id="info-text">Hindari kata sensitif di balasan chat. Mendukung input semua bahasa!</span>
    </div>

    <div id="app-container"></div>

    <!-- Storage Info Panel -->
    <div class="storage-info-panel">
        <div class="storage-info-content">
            <i class="fas fa-database" style="color: var(--primary);"></i>
            <div class="storage-info-text">
                <strong id="storage-title">PENYIMPANAN LOKAL:</strong> 
                <span id="storage-text">Semua data disimpan otomatis di cache browser (LocalStorage) - TANPA KADALUARSA! Data tetap tersedia meski browser ditutup. Mendukung input SEMUA bahasa!</span>
            </div>
        </div>
        <div class="storage-actions">
            <button class="btn-check-storage" onclick="checkStorageUsage()">
                <i class="fas fa-chart-pie"></i> <span id="check-storage-btn">Cek Storage</span>
            </button>
            <button class="btn-clear-storage" onclick="clearAllStorage()">
                <i class="fas fa-broom"></i> <span id="clear-storage-btn">Bersihkan Semua</span>
            </button>
        </div>
    </div>

    <!-- Flag Counter Section -->
    <div class="flag-counter-container">
        <a href="https://info.flagcounter.com/LmOi" target="_blank">
            <img src="https://s01.flagcounter.com/count/LmOi/bg_050B42/txt_FFFFFF/border_CCCCCC/columns_2/maxflags_10/viewers_Total+Visit/labels_1/pageviews_1/flags_0/percent_1/" 
                 alt="Flag Counter" 
                 border="0"
                 class="flag-counter-img">
        </a>
    </div>

    <div class="fab" onclick="showCreateFolderModal()">
        <i class="fas fa-plus"></i>
    </div>

    <!-- Modal Create New Folder -->
    <div class="modal-overlay" id="createFolderModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">Buat Folder Baru</div>
                <button class="modal-close" onclick="hideCreateFolderModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" id="folder-name-label">Nama Folder:</label>
                    <input type="text" class="form-input" id="newFolderName" placeholder="Nama Folder Baru" value="Nama Folder Baru">
                    <div class="form-hint" id="folder-name-hint">Masukkan nama deskriptif untuk folder baru Anda (contoh: "Pesan Selamat Datang", "Info Pengiriman", dll.)</div>
                </div>
                
                <div class="example-item">
                    <div class="example-title" id="example-title">üìÅ Contoh Folder yang Dibuat:</div>
                    <div class="example-text" id="example-text">
                        Setelah dibuat, folder ini akan berisi:<br>
                        1. Contoh pesan yang menunjukkan cara penggunaan<br>
                        2. Anda bisa tambah pesan dengan klik "Tambah Pesan"<br>
                        3. Tap teks pesan apa saja untuk menyalin ke clipboard<br>
                        4. Edit atau hapus pesan menggunakan tombol
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="hideCreateFolderModal()">
                    <i class="fas fa-times"></i> <span id="cancel-btn-modal">Batal</span>
                </button>
                <button class="btn btn-primary" onclick="createNewFolderFromModal()">
                    <i class="fas fa-check"></i> <span id="create-btn">Buat Folder</span>
                </button>
            </div>
        </div>
    </div>

    <div id="toast"><i class="fas fa-check-circle"></i> <span id="toast-text">‚úÖ Teks berhasil disalin!</span></div>

    <script>
        // --- 1. DATA MASTER (DUA BAHASA) ---
        const defaultData = {
            id: [
                { 
                    id: 'cat_0', 
                    title: 'Cek Stok (Ready/Habis)', 
                    icon: 'fa-cubes', 
                    color: '#3b82f6', 
                    items: [
                        { id: 'm01', title: 'Barang Ready Stock', text: 'Hai Kak! Produk ini READY STOCK dan siap kirim ya. Selama varian masih bisa diklik, berarti barang tersedia. Silakan langsung di-checkout sebelum kehabisan! üî•' },
                        { id: 'm02', title: 'Stok Habis/Kosong', text: 'Mohon maaf Kak, untuk varian tersebut saat ini sedang habis (Sold Out). üôè Kami akan restock secepatnya. Boleh follow toko kami untuk update terbarunya ya. Terima kasih!' },
                        { id: 'm03', title: 'Stok Menipis', text: 'Hai Kak, stoknya tinggal sedikit lagi nih. Siapa cepat dia dapat ya Kak. Yuk segera diamankan pesananannya sekarang! üòä' }
                    ]
                },
                { 
                    id: 'cat_1', 
                    title: 'Komplain & Review Buruk', 
                    icon: 'fa-triangle-exclamation', 
                    color: '#ef4444', 
                    items: [
                        { id: 'm11', title: 'Minta Maaf & Solusi (Sopan)', text: 'Mohon maaf atas ketidaknyamanannya, Kak. Kepuasan Kakak adalah prioritas kami. Boleh tolong infokan detail kendalanya via chat ini agar kami bisa bantu berikan solusi terbaik? Terima kasih.' },
                        { id: 'm12', title: 'Respons Bintang 1 Tanpa Alasan', text: 'Halo Kak, mohon maaf jika produk kami tidak memenuhi ekspektasi. Kami selalu berusaha memberikan yang terbaik. Jika ada cacat produk, mohon chat kami untuk proses klaim garansi/retur ya Kak. üôè' }
                    ]
                },
                { 
                    id: 'cat_2', 
                    title: 'Balasan Ulasan Bintang 5', 
                    icon: 'fa-star', 
                    color: '#f59e0b', 
                    items: [
                        { id: 'm21', title: 'Terima Kasih Standard', text: 'Terima kasih banyak ulasan bintang 5-nya Kak! üòç Senang sekali Kakak suka dengan produknya. Semoga awet dan ditunggu orderan selanjutnya ya!' },
                        { id: 'm22', title: 'Doa Rezeki (Ramah)', text: 'Alhamdulillah, terima kasih Kak sudah belanja di toko kami. Semoga rezekinya lancar terus ya Kak. Ditunggu next ordernya! ‚ù§Ô∏è' }
                    ]
                },
                { 
                    id: 'cat_3', 
                    title: 'Pengiriman & Logistik', 
                    icon: 'fa-truck-fast', 
                    color: '#10b981', 
                    items: [
                        { id: 'm31', title: 'Kapan Dikirim?', text: 'Pesanan yang masuk sebelum jam 15.00 akan dikirim hari ini ya Kak. Resi update otomatis malam hari. Mohon ditunggu update statusnya di aplikasi. Terima kasih! üöö' },
                        { id: 'm32', title: 'Paket Belum Jalan (Stuck)', text: 'Halo Kak, fisik paket sudah kami serahkan ke pihak ekspedisi ya. Saat ini status di sistem mungkin delay update dari pihak kurirnya. Mohon kesediaannya menunggu 1x24 jam kedepan ya Kak. üôè' },
                        { id: 'm33', title: 'Paket Hilang/Lama Sampai', text: 'Mohon maaf atas keterlambatannya Kak. Kami sudah bantu follow-up ke pihak ekspedisi terkait paket Kakak. Jika dalam 2 hari tidak ada pergerakan, silakan ajukan pengembalian dana (paket hilang) via sistem ya Kak.' }
                    ]
                },
                { 
                    id: 'cat_4', 
                    title: 'Paket Tidak Sesuai/Rusak', 
                    icon: 'fa-box-open', 
                    color: '#6366f1', 
                    items: [
                        { id: 'm41', title: 'Minta Bukti Video', text: 'Mohon maaf atas kendalanya Kak. üôè Bisa tolong lampirkan video unboxing (buka paket) agar bisa kami bantu pengecekan dengan tim packing? Kami akan bertanggung jawab penuh jika ada kesalahan.' },
                        { id: 'm42', title: 'Barang Cacat/Rusak', text: 'Waduh, mohon maaf sekali barang sampai dalam kondisi rusak. Jangan selesaikan pesanan dulu ya Kak. Silakan ajukan pengembalian barang/dana via aplikasi, nanti kami approve segera.' }
                    ]
                },
                { 
                    id: 'cat_5', 
                    title: 'Masalah Return (Pengembalian)', 
                    icon: 'fa-rotate-left', 
                    color: '#a855f7', 
                    items: [
                        { id: 'm51', title: 'Cara Mengajukan Return', text: 'Halo Kak, untuk proses retur yang aman, silakan klik tombol \'Ajukan Pengembalian\' pada rincian pesanan Kakak. Ikuti instruksi di aplikasi untuk mendapatkan resi pengembalian gratis ongkir.' },
                        { id: 'm52', title: 'Return Ditolak (Salah Alasan)', text: 'Halo Kak, pengajuan returnya kami tolak dulu karena alasan yang dipilih kurang tepat. Silakan ajukan ulang dengan memilih alasan "Barang Berubah Pikiran" atau "Produk Tidak Berfungsi" ya Kak agar bisa kami proses.' }
                    ]
                },
                { 
                    id: 'cat_6', 
                    title: 'Barang Tertukar', 
                    icon: 'fa-arrow-right-arrow-left', 
                    color: '#ec4899', 
                    items: [
                        { id: 'm61', title: 'Salah Kirim Varian', text: 'Mohon maaf Kak, sepertinya tim packing kami salah menempelkan resi/mengambil barang. üôè Kami akan kirimkan barang penggantinya. Silakan ajukan penukaran barang di sistem ya Kak.' }
                    ]
                },
                { 
                    id: 'cat_7', 
                    title: 'Produk Tidak Berfungsi (Trouble)', 
                    icon: 'fa-plug', 
                    color: '#f97316', 
                    items: [
                        { id: 'm71', title: 'Panduan Pemakaian', text: 'Halo Kak, untuk produk ini apakah sudah dicoba [Isi Instruksi Singkat, misal: cas dulu 2 jam]? Terkadang produk butuh daya awal. Jika masih tidak menyala, kami siap ganti baru.' }
                    ]
                },
                { 
                    id: 'cat_8', 
                    title: 'Pertanyaan Umum (COD/Asli)', 
                    icon: 'fa-circle-question', 
                    color: '#06b6d4', 
                    items: [
                        { id: 'm81', title: 'Apakah Bisa COD?', text: 'Bisa banget Kak! Toko kami support COD (Bayar di Tempat) ke seluruh Indonesia. Pastikan alamat lengkap dan nomor HP aktif ya saat checkout. Ditunggu! üòä' },
                        { id: 'm82', title: 'Apakah Produk Original?', text: 'Kami jamin 100% Original Kak. Barang kami ambil langsung dari distributor resmi. Ada garansi uang kembali jika terbukti tidak ori. Silakan diorder dengan tenang. ‚ú®' },
                        { id: 'm83', title: 'Minta Realpict', text: 'Foto yang dipajang di etalase sudah foto asli (Real Picture) dari tim kami ya Kak. Apa yang Kakak lihat, itu yang akan Kakak dapatkan. üëå' }
                    ]
                }
            ],
            en: [
                { 
                    id: 'cat_0', 
                    title: 'Check Stock (Ready/Out)', 
                    icon: 'fa-cubes', 
                    color: '#3b82f6', 
                    items: [
                        { id: 'm01', title: 'Product Ready Stock', text: 'Hi! This product is READY STOCK and ready to ship. As long as the variant can still be clicked, the item is available. Please checkout immediately before it runs out! üî•' },
                        { id: 'm02', title: 'Out of Stock/Empty', text: 'Sorry, for that variant is currently out of stock (Sold Out). üôè We will restock as soon as possible. Please follow our store for the latest updates. Thank you!' },
                        { id: 'm03', title: 'Stock Running Low', text: 'Hi, stock is running low. First come first served. Secure your order now! üòä' }
                    ]
                },
                { 
                    id: 'cat_1', 
                    title: 'Complaints & Bad Reviews', 
                    icon: 'fa-triangle-exclamation', 
                    color: '#ef4444', 
                    items: [
                        { id: 'm11', title: 'Apology & Solution (Polite)', text: 'We apologize for the inconvenience. Your satisfaction is our priority. Could you please provide details about the issue via this chat so we can help provide the best solution? Thank you.' },
                        { id: 'm12', title: 'Response to 1 Star Without Reason', text: 'Hello, we apologize if our product did not meet expectations. We always strive to provide the best. If there is a product defect, please chat us for the warranty/return claim process. üôè' }
                    ]
                },
                { 
                    id: 'cat_2', 
                    title: '5 Star Review Replies', 
                    icon: 'fa-star', 
                    color: '#f59e0b', 
                    items: [
                        { id: 'm21', title: 'Standard Thank You', text: 'Thank you so much for the 5 star review! üòç We are very happy that you like our product. May it last long and we look forward to your next order!' },
                        { id: 'm22', title: 'Blessing Prayer (Friendly)', text: 'Alhamdulillah, thank you for shopping at our store. May your prosperity continue to flow. We await your next order! ‚ù§Ô∏è' }
                    ]
                },
                { 
                    id: 'cat_3', 
                    title: 'Shipping & Logistics', 
                    icon: 'fa-truck-fast', 
                    color: '#10b981', 
                    items: [
                        { id: 'm31', title: 'When Will It Be Shipped?', text: 'Orders placed before 3:00 PM will be shipped today. Tracking number updates automatically in the evening. Please wait for status updates in the app. Thank you! üöö' },
                        { id: 'm32', title: 'Package Not Moving (Stuck)', text: 'Hello, the physical package has been handed over to the expedition party. Currently the status in the system may be delayed update from the courier side. Please wait 1x24 hours ahead. üôè' },
                        { id: 'm33', title: 'Package Lost/Late Arrival', text: 'We apologize for the delay. We have helped follow up with the expedition regarding your package. If there is no movement within 2 days, please submit a refund request (lost package) via the system.' }
                    ]
                },
                { 
                    id: 'cat_4', 
                    title: 'Wrong/Damaged Package', 
                    icon: 'fa-box-open', 
                    color: '#6366f1', 
                    items: [
                        { id: 'm41', title: 'Request Video Evidence', text: 'We apologize for the trouble. üôè Could you please attach an unboxing video (opening package) so we can help check with the packing team? We will be fully responsible if there is an error.' },
                        { id: 'm42', title: 'Defective/Damaged Item', text: 'Oh no, we are very sorry the item arrived damaged. Please do not complete the order yet. Please submit a return/refund request via the application, we will approve immediately.' }
                    ]
                },
                { 
                    id: 'cat_5', 
                    title: 'Return Issues', 
                    icon: 'fa-rotate-left', 
                    color: '#a855f7', 
                    items: [
                        { id: 'm51', title: 'How to Submit Return', text: 'Hello, for a safe return process, please click the \'Submit Return\' button in your order details. Follow the instructions in the application to get a free return shipping tracking number.' },
                        { id: 'm52', title: 'Return Rejected (Wrong Reason)', text: 'Hello, we rejected the return request because the reason chosen was not appropriate. Please resubmit by selecting the reason "Changed Mind" or "Product Not Working" so we can process it.' }
                    ]
                },
                { 
                    id: 'cat_6', 
                    title: 'Swapped Items', 
                    icon: 'fa-arrow-right-arrow-left', 
                    color: '#ec4899', 
                    items: [
                        { id: 'm61', title: 'Wrong Variant Sent', text: 'We apologize, it seems our packing team stuck the wrong tracking number/took the wrong item. üôè We will send the replacement item. Please submit an item exchange request in the system.' }
                    ]
                },
                { 
                    id: 'cat_7', 
                    title: 'Product Not Working (Trouble)', 
                    icon: 'fa-plug', 
                    color: '#f97316', 
                    items: [
                        { id: 'm71', title: 'Usage Guide', text: 'Hello, for this product, have you tried [Fill Brief Instruction, e.g.: charge for 2 hours first]? Sometimes products need initial power. If it still doesn\'t work, we are ready to replace it with a new one.' }
                    ]
                },
                { 
                    id: 'cat_8', 
                    title: 'Frequently Asked Questions (COD/Original)', 
                    icon: 'fa-circle-question', 
                    color: '#06b6d4', 
                    items: [
                        { id: 'm81', title: 'Is COD Available?', text: 'Yes, definitely! Our store supports COD (Cash on Delivery) throughout Indonesia. Make sure your address is complete and your mobile number is active when checking out. We await your order! üòä' },
                        { id: 'm82', title: 'Is the Product Original?', text: 'We guarantee 100% Original. Our items are taken directly from official distributors. There is a money back guarantee if proven not original. Please order with peace of mind. ‚ú®' },
                        { id: 'm83', title: 'Request Real Photo', text: 'The photos displayed in the showcase are original photos (Real Picture) from our team. What you see is what you will get. üëå' }
                    ]
                }
            ]
        };

        // --- 2. LOGIKA UTAMA ---
        let appData = [];
        const STORAGE_KEY = 'SellerTiktokChatPro_Data'; 
        const BANNED_KEYWORDS = ["whatsapp", "wa ", "08", "no hp", "ig", "instagram", "shopee", "tokopedia", "lazada", "tf", "transfer", "bca", "mandiri", "diluar aplikasi", "putih instan", "permanen", "garansi uang kembali", "kw", "ori reject"];

        // --- 3. MULTI BAHASA (i18n) ---
        const translations = {
            id: {
                // Header
                'app-title': 'Seller Tiktok Chat Pro Custom',
                'reset-btn': 'Reset',
                'delete-btn': 'Hapus Semua',
                'info-title': 'INFO PENTING:',
                'info-text': 'Hindari kata sensitif di balasan chat. Mendukung input semua bahasa!',
                'toast-text': '‚úÖ Teks berhasil disalin!',
                
                // Categories
                'category-default': 'Nama Folder Baru',
                'add-message': 'Tambah Pesan',
                'message-title': 'Judul Pesan',
                'message-content': 'Tulis balasan di sini... (Mendukung SEMUA bahasa!)',
                'tap-hint': 'Tap teks di atas untuk menyalin',
                
                // Buttons
                'delete-item': 'Hapus',
                'edit-btn': 'Edit',
                'cancel-btn': 'Batal',
                'save-btn': 'Simpan',
                
                // Confirmation Messages
                'confirm-reset': '‚ö†Ô∏è PERINGATAN: Semua data script Anda akan dihapus dan dikembalikan ke pengaturan awal (pabrik).\n\nApakah Anda yakin?',
                'confirm-delete-all': '‚ö†Ô∏è PERINGATAN KERAS: Menu dan semua script akan dihapus TOTAL!\n\nAnda harus membuatnya lagi dari nol.\nApakah Anda yakin?',
                'confirm-delete-category': 'Hapus kategori folder ini?',
                'confirm-delete-message': 'Hapus pesan ini?',
                'confirm-banned-words': '‚ö†Ô∏è Ada kata terlarang (${violations}). Yakin simpan?',
                
                // Success Messages
                'success-reset': 'Data berhasil dikembalikan ke default.',
                
                // Empty State
                'empty-state': 'Belum ada menu tersimpan.<br>Klik tombol (+) di bawah untuk membuat baru.',
                
                // Warning
                'warning-title': 'PERINGATAN',
                'warning-banned': 'Kata "${words}" dilarang.',
                
                // Language
                'current-lang': 'ID',
                
                // Storage Info
                'storage-title': 'PENYIMPANAN LOKAL:',
                'storage-text': 'Semua data disimpan otomatis di cache browser (LocalStorage) - TANPA KADALUARSA! Data tetap tersedia meski browser ditutup. Mendukung input SEMUA bahasa!',
                'check-storage-btn': 'Cek Storage',
                'clear-storage-btn': 'Bersihkan Semua',
                'confirm-clear-storage': '‚ö†Ô∏è PERINGATAN: Semua data termasuk tema dan bahasa akan dihapus dari cache browser.\n\nAplikasi akan kembali ke pengaturan pabrik.\nApakah Anda yakin?',
                'storage-cleared': '‚úÖ Semua data cache telah dibersihkan.',
                'storage-info': 'Data tersimpan: ${size} KB (Mendukung bahasa tak terbatas!)',
                'storage-empty': 'Tidak ada data tersimpan',
                
                // Modal
                'modal-title': 'Buat Folder Baru',
                'folder-name-label': 'Nama Folder:',
                'folder-name-hint': 'Masukkan nama deskriptif untuk folder baru Anda (contoh: "Pesan Selamat Datang", "Info Pengiriman", dll.)',
                'example-title': 'üìÅ Contoh Folder yang Dibuat:',
                'example-text': 'Setelah dibuat, folder ini akan berisi:<br>1. Contoh pesan yang menunjukkan cara penggunaan<br>2. Anda bisa tambah pesan dengan klik "Tambah Pesan"<br>3. Tap teks pesan apa saja untuk menyalin ke clipboard<br>4. Edit atau hapus pesan menggunakan tombol',
                'cancel-btn-modal': 'Batal',
                'create-btn': 'Buat Folder'
            },
            en: {
                // Header
                'app-title': 'Seller Tiktok Chat Pro Custom',
                'reset-btn': 'Reset',
                'delete-btn': 'Delete All',
                'info-title': 'IMPORTANT INFO:',
                'info-text': 'Avoid sensitive words in chat replies. Supports all languages input!',
                'toast-text': '‚úÖ Text copied successfully!',
                
                // Categories
                'category-default': 'New Folder Name',
                'add-message': 'Add Message',
                'message-title': 'Message Title',
                'message-content': 'Write reply here... (Supports ALL languages!)',
                'tap-hint': 'Tap text above to copy',
                
                // Buttons
                'delete-item': 'Delete',
                'edit-btn': 'Edit',
                'cancel-btn': 'Cancel',
                'save-btn': 'Save',
                
                // Confirmation Messages
                'confirm-reset': '‚ö†Ô∏è WARNING: All your script data will be deleted and restored to factory settings.\n\nAre you sure?',
                'confirm-delete-all': '‚ö†Ô∏è CRITICAL WARNING: All menus and scripts will be COMPLETELY DELETED!\n\nYou will have to create them again from scratch.\nAre you sure?',
                'confirm-delete-category': 'Delete this category folder?',
                'confirm-delete-message': 'Delete this message?',
                'confirm-banned-words': '‚ö†Ô∏è There are banned words (${violations}). Are you sure you want to save?',
                
                // Success Messages
                'success-reset': 'Data successfully restored to default.',
                
                // Empty State
                'empty-state': 'No menus saved yet.<br>Click the (+) button below to create a new one.',
                
                // Warning
                'warning-title': 'WARNING',
                'warning-banned': 'Words "${words}" are banned.',
                
                // Language
                'current-lang': 'EN',
                
                // Storage Info
                'storage-title': 'LOCAL STORAGE:',
                'storage-text': 'All data saved automatically in browser cache (LocalStorage) - NO EXPIRATION! Data remains available even after closing browser. Supports ANY language input!',
                'check-storage-btn': 'Check Storage',
                'clear-storage-btn': 'Clear All',
                'confirm-clear-storage': '‚ö†Ô∏è WARNING: All data including theme and language will be removed from browser cache.\n\nApp will return to factory settings.\nAre you sure?',
                'storage-cleared': '‚úÖ All cache data has been cleared.',
                'storage-info': 'Data stored: ${size} KB (Supports unlimited languages!)',
                'storage-empty': 'No data stored',
                
                // Modal
                'modal-title': 'Create New Folder',
                'folder-name-label': 'Folder Name:',
                'folder-name-hint': 'Enter a descriptive name for your new folder (e.g., "Welcome Messages", "Shipping Info", etc.)',
                'example-title': 'üìÅ Example Folder Created:',
                'example-text': 'After creating, this folder will contain:<br>1. An example message showing how to use<br>2. You can add more messages by clicking "Add Message"<br>3. Tap any message text to copy it to clipboard<br>4. Edit or delete messages using the buttons',
                'cancel-btn-modal': 'Cancel',
                'create-btn': 'Create Folder'
            }
        };

        let currentLanguage = 'id'; // DEFAULT BAHASA INDONESIA
        const LANGUAGE_KEY = 'SellerTiktokChatPro_Language';

        // Fungsi untuk mengubah bahasa
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem(LANGUAGE_KEY, lang);
            applyLanguage();
            
            // Update dropdown
            document.querySelectorAll('.lang-option').forEach(option => {
                option.classList.remove('active');
                if (option.dataset.lang === lang) {
                    option.classList.add('active');
                }
            });
            
            // Close dropdown
            document.getElementById('lang-dropdown').classList.remove('show');
            
            // Update modal text if it's open
            updateModalText();
            
            // Show language change notification
            const message = lang === 'en' 
                ? 'üåê Language changed to English' 
                : 'üåê Bahasa diubah ke Indonesia';
            showToast(message, 2000);
        }

        // Fungsi untuk menerapkan terjemahan
        function applyLanguage() {
            const lang = currentLanguage;
            const t = translations[lang];
            
            // Update semua elemen dengan data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (t[key]) {
                    element.textContent = t[key];
                }
            });
            
            // Update elemen khusus
            document.getElementById('app-title').textContent = t['app-title'];
            document.getElementById('reset-btn').textContent = t['reset-btn'];
            document.getElementById('delete-btn').textContent = t['delete-btn'];
            document.getElementById('info-title').textContent = t['info-title'];
            document.getElementById('info-text').textContent = t['info-text'];
            document.getElementById('toast-text').textContent = t['toast-text'];
            document.getElementById('current-lang').textContent = t['current-lang'];
            document.getElementById('storage-title').textContent = t['storage-title'];
            document.getElementById('storage-text').textContent = t['storage-text'];
            document.getElementById('check-storage-btn').textContent = t['check-storage-btn'];
            document.getElementById('clear-storage-btn').textContent = t['clear-storage-btn'];
            
            // Update document title
            document.title = t['app-title'];
            
            // Render ulang untuk update teks dinamis
            if (document.getElementById('app-container').innerHTML !== '') {
                render();
            }
        }

        // Update modal text
        function updateModalText() {
            const t = translations[currentLanguage];
            const modal = document.getElementById('createFolderModal');
            
            if (modal && modal.classList.contains('active')) {
                document.getElementById('modal-title').textContent = t['modal-title'];
                document.getElementById('folder-name-label').textContent = t['folder-name-label'];
                document.getElementById('folder-name-hint').innerHTML = t['folder-name-hint'];
                document.getElementById('example-title').textContent = t['example-title'];
                document.getElementById('example-text').innerHTML = t['example-text'];
                document.getElementById('cancel-btn-modal').textContent = t['cancel-btn-modal'];
                document.getElementById('create-btn').textContent = t['create-btn'];
                
                // Update placeholder
                const input = document.getElementById('newFolderName');
                input.placeholder = t['category-default'];
                if (input.value === 'Nama Folder Baru' || input.value === 'New Folder Name') {
                    input.value = t['category-default'];
                }
            }
        }

        // Fungsi untuk mendapatkan terjemahan
        function t(key, variables = {}) {
            let text = translations[currentLanguage][key] || translations['id'][key] || key;
            
            // Replace variables
            Object.keys(variables).forEach(variable => {
                text = text.replace(`\${${variable}}`, variables[variable]);
            });
            
            return text;
        }

        // Toggle dropdown bahasa
        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('lang-dropdown');
            dropdown.classList.toggle('show');
        }

        // Tutup dropdown saat klik di luar
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('lang-dropdown');
            const langBtn = document.querySelector('.lang-btn');
            
            if (dropdown && !dropdown.contains(event.target) && !langBtn.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // --- 4. INITIALIZATION & STORAGE ---
        function init() {
            // Dark Mode
            const savedTheme = localStorage.getItem('theme');
            if (!savedTheme) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                document.getElementById('checkbox').checked = true;
            } else {
                document.documentElement.setAttribute('data-theme', savedTheme);
                if(savedTheme === 'dark') document.getElementById('checkbox').checked = true;
            }

            // Load Language - Default to Indonesian
            const savedLanguage = localStorage.getItem(LANGUAGE_KEY);
            if (savedLanguage) {
                currentLanguage = savedLanguage;
            } else {
                currentLanguage = 'id'; // DEFAULT ID
                localStorage.setItem(LANGUAGE_KEY, 'id');
            }

            // Load Data
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                appData = JSON.parse(savedData);
            } else {
                // Use default data based on current language
                appData = JSON.parse(JSON.stringify(defaultData[currentLanguage]));
            }
            
            // Apply language
            applyLanguage();
            render();
            
            // Tampilkan notifikasi penyimpanan lokal saat pertama kali
            setTimeout(() => {
                showStorageNotification();
            }, 1000);
        }

        function saveData() { 
            localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
            showSaveNotification();
        }

        function resetToDefault() {
            const confirmReset = confirm(t('confirm-reset'));
            if (confirmReset) {
                // Reset to default data for current language
                appData = JSON.parse(JSON.stringify(defaultData[currentLanguage]));
                saveData();
                render();
                showToast('üîÑ ' + t('success-reset'), 3000);
            }
        }

        function deleteAll() {
            const confirmDel = confirm(t('confirm-delete-all'));
            if (confirmDel) {
                appData = [];
                saveData();
                render();
                showToast('üóëÔ∏è ' + (currentLanguage === 'en' ? 'All data has been deleted!' : 'Semua data telah dihapus!'), 3000);
            }
        }

        // --- FUNGSI PENYIMPANAN LOKAL BARU ---
        function checkStorageUsage() {
            let totalSize = 0;
            
            // Hitung ukuran semua data di localStorage
            for(let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                const size = (value.length * 2) / 1024; // Ukuran dalam KB
                totalSize += size;
            }
            
            if (totalSize > 0) {
                showToast('üíæ ' + t('storage-info', {size: totalSize.toFixed(2)}), 3000);
            } else {
                showToast('üíæ ' + t('storage-empty'), 2000);
            }
        }

        function clearAllStorage() {
            const confirmClear = confirm(t('confirm-clear-storage'));
            if (confirmClear) {
                // Hapus semua data localStorage untuk aplikasi ini
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem(LANGUAGE_KEY);
                localStorage.removeItem('theme');
                
                // Reset aplikasi dengan bahasa default (id)
                currentLanguage = 'id';
                appData = JSON.parse(JSON.stringify(defaultData[currentLanguage]));
                
                // Terapkan ulang
                applyLanguage();
                render();
                
                // Tampilkan notifikasi
                showToast('üßπ ' + t('storage-cleared'), 3000);
                showToast('üîÑ ' + (currentLanguage === 'en' ? 'App has been reset to factory settings!' : 'Aplikasi telah direset ke pengaturan pabrik!'), 3000);
            }
        }

        function showStorageNotification() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                const dataSize = (savedData.length * 2) / 1024; // Ukuran dalam KB
                showToast('üíæ ' + t('storage-info', {size: dataSize.toFixed(2)}), 4000);
            }
        }

        function showSaveNotification() {
            const message = currentLanguage === 'en' 
                ? 'üíæ Data saved to browser cache (NO EXPIRATION!)' 
                : 'üíæ Data tersimpan di cache browser (TANPA KADALUARSA!)';
            showToast(message, 2000);
        }

        // Fungsi toast yang dapat dikustomisasi dengan animasi
        function showToast(message, duration = 2000) {
            const toast = document.getElementById('toast');
            const toastText = document.getElementById('toast-text');
            
            toastText.textContent = message;
            toast.classList.add('copy-success');
            toast.className = "show";
            
            setTimeout(() => {
                toast.className = toast.className.replace("show", "");
                toast.classList.remove('copy-success');
            }, duration);
        }

        // --- 5. RENDER SYSTEM ---
        function render() {
            const container = document.getElementById('app-container');
            container.innerHTML = '';

            if (appData.length === 0) {
                container.innerHTML = `<div class="empty-state">${t('empty-state')}</div>`;
                return;
            }

            // Buat dua kolom untuk desktop
            if (window.innerWidth >= 768) {
                const leftColumn = document.createElement('div');
                leftColumn.className = 'left-column';
                const rightColumn = document.createElement('div');
                rightColumn.className = 'right-column';

                // Bagi data menjadi dua bagian untuk dua kolom
                const midPoint = Math.ceil(appData.length / 2);
                const leftData = appData.slice(0, midPoint);
                const rightData = appData.slice(midPoint);

                // Render kolom kiri
                leftData.forEach((cat, catIndex) => {
                    const catDiv = createCategoryItem(cat, catIndex);
                    leftColumn.appendChild(catDiv);
                });

                // Render kolom kanan
                rightData.forEach((cat, catIndex) => {
                    const actualIndex = catIndex + midPoint;
                    const catDiv = createCategoryItem(cat, actualIndex);
                    rightColumn.appendChild(catDiv);
                });

                container.appendChild(leftColumn);
                container.appendChild(rightColumn);
            } else {
                // Untuk mobile, render semua dalam satu kolom
                appData.forEach((cat, catIndex) => {
                    const catDiv = createCategoryItem(cat, catIndex);
                    container.appendChild(catDiv);
                });
            }

            // Inisialisasi Sortable
            initializeSortable();
        }

        // Fungsi untuk membuat item kategori
        function createCategoryItem(cat, catIndex) {
            const catDiv = document.createElement('div');
            catDiv.className = 'category-item';
            catDiv.id = `cat-item-${cat.id}`;
            catDiv.dataset.index = catIndex;
            catDiv.style.setProperty('--color-cat', cat.color || 'var(--color-cat-default)');

            // Panel awalnya TERTUTUP (tidak ada class 'open')
            catDiv.innerHTML = `
                <div class="category-header">
                    <div class="drag-handle cat-handle"><i class="fas fa-grip-lines"></i></div>
                    <div class="header-content" onclick="togglePanel('panel-${cat.id}', 'cat-item-${cat.id}', event)">
                        <i class="fas ${cat.icon || 'fa-folder'}" style="color:var(--color-cat)"></i>
                        <span id="txt-cat-${cat.id}">${cat.title}</span>
                    </div>
                    <div style="display:flex; gap:4px;">
                        <button class="btn-icon btn-top" id="btn-edit-cat-${cat.id}" onclick="editCatMode('${cat.id}', ${catIndex}, event)"><i class="fas fa-pen"></i></button>
                        <button class="btn-icon btn-top hidden" id="btn-save-cat-${cat.id}" onclick="saveCat('${cat.id}', ${catIndex}, event)" style="color:var(--success); border-color:var(--success)"><i class="fas fa-check"></i></button>
                        <button class="btn-icon btn-top" onclick="deleteCat(${catIndex}, event)" style="color:var(--danger); border-color:var(--danger)"><i class="fas fa-trash-alt"></i></button>
                    </div>
                </div>
                
                <div class="panel" id="panel-${cat.id}"> <!-- Tidak ada class 'open' di sini -->
                    <div class="list-scripts" data-cat-index="${catIndex}"></div>
                    <button class="btn" style="width:100%; justify-content:center; margin-top:10px; border-style:dashed;" onclick="addNewItem(${catIndex})">
                        <i class="fas fa-plus"></i> ${t('add-message')}
                    </button>
                </div>
            `;

            const listContainer = catDiv.querySelector('.list-scripts');
            cat.items.forEach((item, itemIndex) => {
                const card = document.createElement('div');
                card.className = 'script-card';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${item.title}</div>
                        <div class="drag-handle card-handle"><i class="fas fa-bars"></i></div>
                    </div>

                    <div id="view-${item.id}">
                        <div class="card-body" onclick="copyText('${item.text.replace(/'/g, "\\'")}', '${item.title.replace(/'/g, "\\'")}')">${item.text}</div>
                        <div class="tap-hint">${t('tap-hint')}</div>
                        
                        <div class="btn-group" id="act-${item.id}" style="margin-top:8px;">
                            <button class="btn btn-danger" onclick="deleteItem(${catIndex}, ${itemIndex}, event)"><i class="fas fa-trash-alt"></i> ${t('delete-item')}</button>
                            <button class="btn" onclick="toggleEditItem('${item.id}', event)"><i class="fas fa-pen"></i> ${t('edit-btn')}</button>
                        </div>
                    </div>

                    <div id="edit-${item.id}" class="edit-area hidden">
                        <div id="alert-${item.id}" class="risk-alert hidden"></div>
                        <input type="text" id="inp-title-${item.id}" class="form-input" value="${item.title}" placeholder="${t('message-title')}">
                        <textarea id="inp-text-${item.id}" class="form-input" onkeyup="handleInputCheck('${item.id}')" placeholder="${t('message-content')}">${item.text}</textarea>
                        <div class="btn-group">
                            <button class="btn btn-danger" onclick="deleteItem(${catIndex}, ${itemIndex})"><i class="fas fa-trash-alt"></i> ${t('delete-item')}</button>
                            <button class="btn" onclick="toggleEditItem('${item.id}')">${t('cancel-btn')}</button>
                            <button class="btn btn-primary" onclick="saveItem('${item.id}', ${catIndex}, ${itemIndex})"><i class="fas fa-save"></i> ${t('save-btn')}</button>
                        </div>
                    </div>
                `;
                listContainer.appendChild(card);
            });

            return catDiv;
        }

        // Inisialisasi Sortable
        function initializeSortable() {
            // Inisialisasi Sortable untuk script cards dalam setiap kategori
            document.querySelectorAll('.list-scripts').forEach(listContainer => {
                if (listContainer.children.length > 0) {
                    new Sortable(listContainer, { 
                        group: 'shared', 
                        animation: 150, 
                        handle: '.card-handle', 
                        onEnd: rebuildData,
                        ghostClass: 'sortable-ghost',
                        chosenClass: 'sortable-chosen'
                    });
                }
            });

            // Inisialisasi Sortable untuk kategori di setiap kolom
            if (window.innerWidth >= 768) {
                // Untuk desktop, kita punya dua kolom
                document.querySelectorAll('.left-column, .right-column').forEach(column => {
                    if (column.children.length > 0) {
                        new Sortable(column, { 
                            animation: 150, 
                            handle: '.cat-handle', 
                            onEnd: function(evt) {
                                // Rebuild data berdasarkan urutan baru
                                rebuildCategoryOrder();
                            },
                            ghostClass: 'sortable-ghost',
                            chosenClass: 'sortable-chosen'
                        });
                    }
                });
            } else {
                // Untuk mobile, semua kategori dalam satu container
                const container = document.getElementById('app-container');
                if (container.children.length > 0) {
                    new Sortable(container, { 
                        animation: 150, 
                        handle: '.cat-handle', 
                        onEnd: function(evt) {
                            // Rebuild data berdasarkan urutan baru
                            rebuildCategoryOrder();
                        },
                        ghostClass: 'sortable-ghost',
                        chosenClass: 'sortable-chosen'
                    });
                }
            }
        }

        // Rebuild urutan kategori
        function rebuildCategoryOrder() {
            const newAppData = [];
            
            if (window.innerWidth >= 768) {
                // Untuk desktop, gabungkan kembali data dari kedua kolom
                const leftColumn = document.querySelector('.left-column');
                const rightColumn = document.querySelector('.right-column');
                
                if (leftColumn) {
                    leftColumn.querySelectorAll('.category-item').forEach(catEl => {
                        const index = parseInt(catEl.dataset.index);
                        if (index < appData.length) {
                            newAppData.push(appData[index]);
                        }
                    });
                }
                
                if (rightColumn) {
                    rightColumn.querySelectorAll('.category-item').forEach(catEl => {
                        const index = parseInt(catEl.dataset.index);
                        if (index < appData.length) {
                            newAppData.push(appData[index]);
                        }
                    });
                }
            } else {
                // Untuk mobile
                const container = document.getElementById('app-container');
                container.querySelectorAll('.category-item').forEach(catEl => {
                    const index = parseInt(catEl.dataset.index);
                    if (index < appData.length) {
                        newAppData.push(appData[index]);
                    }
                });
            }
            
            appData = newAppData;
            saveData();
        }

        // --- 6. INTERACTION LOGIC ---

        function toggleTheme(e) {
            const theme = e.checked ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            const message = theme === 'dark' 
                ? 'üåô Dark mode activated' 
                : '‚òÄÔ∏è Light mode activated';
            showToast(message, 2000);
        }

        // PERBAIKAN: Variabel untuk melacak panel yang sedang terbuka PER KOLOM
        // Untuk mobile (satu kolom) dan desktop (dua kolom)
        let currentlyOpenPanels = { left: null, right: null };

        function togglePanel(panelId, parentId, e) {
            // Cek apakah yang diklik adalah input field (saat mode edit)
            if (e && e.target.tagName === 'INPUT') return; 

            const panel = document.getElementById(panelId);
            const parentDiv = document.getElementById(parentId);
            
            // Tentukan kolom mana (kiri atau kanan)
            let column = 'left';
            if (window.innerWidth >= 768) {
                // Untuk desktop dengan dua kolom
                const leftColumn = document.querySelector('.left-column');
                const rightColumn = document.querySelector('.right-column');
                
                if (leftColumn && leftColumn.contains(parentDiv)) {
                    column = 'left';
                } else if (rightColumn && rightColumn.contains(parentDiv)) {
                    column = 'right';
                }
            } else {
                // Untuk mobile (hanya satu kolom), semua panel dianggap di kolom 'left'
                column = 'left';
            }
            
            // Jika panel ini sudah terbuka, tutup saja
            if (panel.classList.contains('open')) {
                panel.classList.remove('open');
                parentDiv.classList.remove('active-parent');
                currentlyOpenPanels[column] = null;
                return;
            }
            
            // PERBAIKAN: Hanya tutup panel di kolom yang sama (kiri hanya tutup kiri, kanan hanya tutup kanan)
            if (currentlyOpenPanels[column] && currentlyOpenPanels[column] !== panel) {
                currentlyOpenPanels[column].classList.remove('open');
                const previousParent = currentlyOpenPanels[column].parentElement;
                if (previousParent) {
                    previousParent.classList.remove('active-parent');
                }
            }
            
            // Buka panel yang baru diklik
            panel.classList.add('open');
            parentDiv.classList.add('active-parent');
            currentlyOpenPanels[column] = panel;
        }

        function checkContent(text) {
            return BANNED_KEYWORDS.filter(word => text.toLowerCase().includes(word));
        }

        function handleInputCheck(itemId) {
            const text = document.getElementById(`inp-text-${itemId}`).value;
            const alertBox = document.getElementById(`alert-${itemId}`);
            const violations = checkContent(text);
            if (violations.length > 0) {
                alertBox.classList.remove('hidden');
                alertBox.innerHTML = `<i class="fas fa-exclamation-triangle"></i> <b>${t('warning-title')}:</b> ${t('warning-banned', {words: violations.join(', ')})}`;
            } else {
                alertBox.classList.add('hidden');
            }
        }

        // --- MODAL FUNCTIONS ---
        function showCreateFolderModal() {
            const modal = document.getElementById('createFolderModal');
            const input = document.getElementById('newFolderName');
            
            // Update modal text
            updateModalText();
            
            // Show modal
            modal.classList.add('active');
            
            // Focus on input
            setTimeout(() => {
                input.focus();
                input.select();
            }, 100);
        }

        function hideCreateFolderModal() {
            const modal = document.getElementById('createFolderModal');
            modal.classList.remove('active');
        }

        function createNewFolderFromModal() {
            const input = document.getElementById('newFolderName');
            const folderName = input.value.trim();
            
            if (!folderName) {
                showToast('‚ùå ' + (currentLanguage === 'en' ? 'Please enter a folder name!' : 'Harap masukkan nama folder!'), 2000);
                return;
            }
            
            const newId = Date.now();
            const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
            
            // Example item based on current language
            const exampleItem = {
                id: 'example_' + Date.now(),
                title: currentLanguage === 'en' ? 'Example Message' : 'Contoh Pesan',
                text: currentLanguage === 'en' 
                    ? 'Hi! This is an example message. Click on this text to copy it to clipboard. You can edit this message or add new ones using the "Add Message" button below. üòä'
                    : 'Hai! Ini adalah contoh pesan. Klik teks ini untuk menyalin ke clipboard. Anda bisa mengedit pesan ini atau menambah yang baru menggunakan tombol "Tambah Pesan" di bawah. üòä'
            };
            
            const newCategory = {
                id: newId,
                title: folderName,
                icon: 'fa-folder',
                color: randomColor,
                items: [exampleItem] // Add example item
            };
            
            appData.push(newCategory);
            saveData();
            render();
            
            // Hide modal
            hideCreateFolderModal();
            
            // Reset input
            input.value = t('category-default');
            
            // Show success message
            const message = currentLanguage === 'en'
                ? `üìÅ Folder "${folderName}" created with example message!`
                : `üìÅ Folder "${folderName}" dibuat dengan contoh pesan!`;
            showToast(message, 3000);
            
            // Auto-open the new folder
            setTimeout(() => {
                const panel = document.getElementById(`panel-${newId}`);
                const parentDiv = document.getElementById(`cat-item-${newId}`);
                
                if (panel && parentDiv) {
                    panel.classList.add('open');
                    parentDiv.classList.add('active-parent');
                    
                    // Determine column
                    let column = 'left';
                    if (window.innerWidth >= 768) {
                        const leftColumn = document.querySelector('.left-column');
                        const rightColumn = document.querySelector('.right-column');
                        
                        if (leftColumn && leftColumn.contains(parentDiv)) {
                            column = 'left';
                        } else if (rightColumn && rightColumn.contains(parentDiv)) {
                            column = 'right';
                        }
                    }
                    
                    currentlyOpenPanels[column] = panel;
                }
                
                // Scroll to new folder
                window.scrollTo(0, document.body.scrollHeight);
            }, 100);
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('createFolderModal');
            const modalContent = document.querySelector('.modal');
            
            if (modal.classList.contains('active') && !modalContent.contains(event.target) && 
                !event.target.classList.contains('fab') && 
                !event.target.closest('.fab')) {
                hideCreateFolderModal();
            }
        });

        // --- CRUD ACTIONS ---
        
        // Logika Edit Kategori Menu (Langsung)
        function editCatMode(id, index, e) {
            e.stopPropagation();
            
            const contentDiv = document.getElementById(`txt-cat-${id}`).parentNode;
            const spanTitle = document.getElementById(`txt-cat-${id}`);
            
            // 1. Buat input field baru
            const inputField = document.createElement('input');
            inputField.type = 'text';
            inputField.id = `inp-cat-${id}`;
            inputField.value = spanTitle.innerText;
            inputField.onclick = (e) => e.stopPropagation(); // Cegah toggle panel saat klik input
            
            // 2. Ganti span dengan input
            contentDiv.replaceChild(inputField, spanTitle);

            // 3. Ganti tombol aksi
            document.getElementById(`btn-edit-cat-${id}`).classList.add('hidden');
            document.getElementById(`btn-save-cat-${id}`).classList.remove('hidden');
            inputField.focus();
        }

        // Logika Simpan Kategori Menu (Langsung)
        function saveCat(id, index, e) {
            e.stopPropagation();
            const inputField = document.getElementById(`inp-cat-${id}`);
            
            if (inputField) {
                appData[index].title = inputField.value;
                saveData(); 
                // Render ulang untuk mengembalikan ke tampilan span yang baru
                render(); 
            }
        }

        function deleteCat(index, e) {
            e.stopPropagation();
            if(confirm(t('confirm-delete-category'))) { 
                appData.splice(index, 1); 
                saveData(); 
                render(); 
            }
        }

        function toggleEditItem(itemId, e) {
            if(e) e.stopPropagation();
            const view = document.getElementById(`view-${itemId}`);
            const edit = document.getElementById(`edit-${itemId}`);
            
            if(edit.classList.contains('hidden')){
                view.classList.add('hidden'); 
                edit.classList.remove('hidden');
                handleInputCheck(itemId);
            } else {
                view.classList.remove('hidden'); 
                edit.classList.add('hidden');
            }
        }

        function saveItem(itemId, catIndex, itemIndex) {
            const text = document.getElementById(`inp-text-${itemId}`).value;
            const violations = checkContent(text);
            if (violations.length > 0 && !confirm(t('confirm-banned-words', {violations: violations.join(', ')}))) return;
            
            appData[catIndex].items[itemIndex].title = document.getElementById(`inp-title-${itemId}`).value;
            appData[catIndex].items[itemIndex].text = text;
            saveData(); 
            
            // Dapatkan ID kategori sebelum render
            const catId = appData[catIndex].id;
            
            render();
            // Re-open panel
            setTimeout(() => {
                const panel = document.getElementById(`panel-${catId}`);
                const parentDiv = document.getElementById(`cat-item-${catId}`);
                
                if (panel && parentDiv) {
                    panel.classList.add('open');
                    parentDiv.classList.add('active-parent');
                    
                    // Update currentlyOpenPanels
                    let column = 'left';
                    if (window.innerWidth >= 768) {
                        const leftColumn = document.querySelector('.left-column');
                        const rightColumn = document.querySelector('.right-column');
                        
                        if (leftColumn && leftColumn.contains(parentDiv)) {
                            column = 'left';
                        } else if (rightColumn && rightColumn.contains(parentDiv)) {
                            column = 'right';
                        }
                    }
                    
                    currentlyOpenPanels[column] = panel;
                }
            }, 50);
        }

        function deleteItem(catIndex, itemIndex, e) {
            if(e) e.stopPropagation();

            if(confirm(t('confirm-delete-message'))) {
                const catId = appData[catIndex].id;
                appData[catIndex].items.splice(itemIndex, 1);
                saveData(); 
                
                if (appData[catIndex].items.length > 0) {
                     render();
                    setTimeout(() => {
                        const panel = document.getElementById(`panel-${catId}`);
                        const parentDiv = document.getElementById(`cat-item-${catId}`);
                        
                        if (panel && parentDiv) {
                            panel.classList.add('open');
                            parentDiv.classList.add('active-parent');
                            
                            // Update currentlyOpenPanels
                            let column = 'left';
                            if (window.innerWidth >= 768) {
                                const leftColumn = document.querySelector('.left-column');
                                const rightColumn = document.querySelector('.right-column');
                                
                                if (leftColumn && leftColumn.contains(parentDiv)) {
                                    column = 'left';
                                } else if (rightColumn && rightColumn.contains(parentDiv)) {
                                    column = 'right';
                                }
                            }
                            
                            currentlyOpenPanels[column] = panel;
                        }
                    }, 50);
                } else {
                    render();
                }
            }
        }

        function addNewItem(catIndex) {
            appData[catIndex].items.push({ 
                id: Date.now(), 
                title: t('message-title'), 
                text: t('message-content') 
            });
            saveData(); 
            render();
            setTimeout(() => {
                const catId = appData[catIndex].id;
                const panel = document.getElementById(`panel-${catId}`);
                const parentDiv = document.getElementById(`cat-item-${catId}`);
                
                if (panel && parentDiv) {
                    panel.classList.add('open');
                    parentDiv.classList.add('active-parent');
                    
                    // Update currentlyOpenPanels
                    let column = 'left';
                    if (window.innerWidth >= 768) {
                        const leftColumn = document.querySelector('.left-column');
                        const rightColumn = document.querySelector('.right-column');
                        
                        if (leftColumn && leftColumn.contains(parentDiv)) {
                            column = 'left';
                        } else if (rightColumn && rightColumn.contains(parentDiv)) {
                            column = 'right';
                        }
                    }
                    
                    currentlyOpenPanels[column] = panel;
                }
            }, 50);
        }

        function rebuildData() {
            const newAppData = [];
            document.querySelectorAll('.category-item').forEach(catEl => {
                const oldIndex = catEl.dataset.index;
                if (oldIndex < appData.length) {
                    const baseCat = appData[oldIndex];
                    const newItems = [];
                    catEl.querySelectorAll('.script-card').forEach(itemEl => {
                        const title = itemEl.querySelector('.card-title').innerText;
                        const body = itemEl.querySelector('.card-body').innerText;
                        newItems.push({ id: 'm'+Math.random().toString(36).substr(2,9), title: title, text: body });
                    });
                    baseCat.items = newItems;
                    newAppData.push(baseCat);
                }
            });
            appData = newAppData;
            saveData();
        }

        function copyText(txt, title = '') {
            // Fallback untuk perangkat mobile
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(txt).then(() => {
                    showCopySuccess(title);
                }).catch(err => {
                    fallbackCopyText(txt, title);
                });
            } else {
                fallbackCopyText(txt, title);
            }
        }

        function fallbackCopyText(txt, title = '') {
            const textArea = document.createElement("textarea");
            textArea.value = txt;
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            textArea.style.top = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showCopySuccess(title);
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
                showToast('‚ùå Copy failed!', 2000);
            }
            document.body.removeChild(textArea);
        }

        function showCopySuccess(title = '') {
            const toastText = document.getElementById('toast-text');
            const successMessage = title 
                ? `‚úÖ Copied: "${title}"`
                : t('toast-text');
            
            showToast(successMessage, 2000);
        }

        // Init App
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
